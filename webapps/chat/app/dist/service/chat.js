/*
 * @packet service.chat;
 */
Module({name:"chatservice",extend:"publicservice",option:{},init:function(){this.start()},service_login:function(t){var i=this;this.postRequest(sitePath+"comet/join",{username:t}).done(function(e){i.id=t,i.data.id=t,i.data.onlines=e,i.read(),i.trigger("loginend",i.data)})},read:function(){var t=this;this.stop(),this.postRequest(sitePath+"comet/read",{id:this.id}).done(function(i){t.trigger("message",i),t.read(),t.start()})},service_write:function(t){this.postRequest(sitePath+"comet/send",$.extend({id:this.id},t)).done(function(t){})},quit:function(){this.postRequest(sitePath+"comet/quit",{id:this.id}).done(function(t){console.log("quit-%o",t)})},broadcast:function(t){this.write(t)}}),Module({name:"chatlistservice",extend:"publicservice",option:{},init:function(){this.data=[],this.start()},service_add:function(t){for(var i=t.id,e=!1,s=0;s<this.data.length;s++)this.data[s].id===i&&(e=!0,this.data[s]=t);e||this.data.push(t),console.log(this.data),this.trigger()},service_remove:function(t){for(var i=[],e=0;e<this.data.length;e++)this.data[e].id!==t&&i.push(this.data[e]);this.data=i,this.trigger()},service_state:function(t){for(var i=0;i<this.data.length;i++)this.data[i].id===t&&(this.data[i].state=!0);this.trigger()},service_unstate:function(t){for(var i=0;i<this.data.length;i++)this.data[i].id===t&&(this.data[i].state=!1);this.trigger()}}),Module({name:"chatboxservice",extend:"privateservice",init:function(){this.data={id:this.option.id,info:this.option.info,message:[]},this.start()},service_add:function(t){this.data.message.push(t),this.trigger()}});